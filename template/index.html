<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet" />
    <title>Icons - Icons Factory</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: white;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
      }

      .icons-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .icon-card {
        background: #d2d3d4;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s;
      }

      .icon-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      }

      .icon-image-container {
        height: 64px;
        width: 64px;
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .icon-image {
        max-width: 64px;
        max-height: 64px;
        width: auto;
        height: auto;
        display: block;
        object-fit: contain;
      }

      .icon-name {
        text-align: center;
        font-weight: 500;
        margin-bottom: 8px;
        color: #333;
        word-break: break-word;
      }

      .icon-size {
        text-align: center;
        font-size: 12px;
        color: #666;
        margin-bottom: 15px;
      }

      .button-group {
        display: flex;
        gap: 8px;
        justify-content: center;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .btn-copy {
        background-color: #4285f4;
        color: white;
      }

      .btn-copy:hover {
        background-color: #3367d6;
      }

      .btn-download {
        background-color: #34a853;
        color: white;
      }

      .btn-download:hover {
        background-color: #137333;
      }

      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #333;
        color: white;
        padding: 12px 20px;
        border-radius: 4px;
        opacity: 0;
        transform: translateY(100%);
        transition: all 0.3s;
        z-index: 1000;
      }

      .toast.show {
        opacity: 1;
        transform: translateY(0);
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #666;
      }

      /* æ¤œç´¢æ©Ÿèƒ½ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .search-container {
        max-width: 500px;
        margin: 0 auto 30px;
        position: relative;
      }

      .search-box {
        position: relative;
        display: flex;
        align-items: center;
      }

      .search-input {
        width: 100%;
        padding: 12px 20px 12px 45px;
        font-size: 16px;
        border: 2px solid #ddd;
        border-radius: 25px;
        background: white;
        outline: none;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        border-color: #4285f4;
        box-shadow: 0 2px 8px rgba(66, 133, 244, 0.2);
      }

      .search-icon {
        position: absolute;
        left: 15px;
        font-size: 16px;
        color: #666;
        pointer-events: none;
      }

      .search-clear {
        position: absolute;
        right: 15px;
        background: none;
        border: none;
        font-size: 18px;
        color: #999;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .search-clear.visible {
        opacity: 1;
      }

      .search-clear:hover {
        color: #666;
      }

      .no-results {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .no-results-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .search-stats {
        text-align: center;
        margin-bottom: 20px;
        color: #666;
        font-size: 14px;
      }

      /* æ¤œç´¢ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
      .highlight {
        background: #fff3cd;
        padding: 2px 4px;
        border-radius: 3px;
        font-weight: 600;
      }

      @media (max-width: 768px) {
        .search-input {
          font-size: 16px; /* iOSã§ã‚ºãƒ¼ãƒ ã‚’é˜²ã */
        }
      }
    </style>
  </head>
  <body>
    <h1 id="page-title">Icons</h1>

    <!-- æ¤œç´¢æ©Ÿèƒ½ -->
    <div class="search-container">
      <div class="search-box">
        <input
          type="text"
          id="category-search"
          class="search-input"
          placeholder="ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ¤œç´¢..."
          autocomplete="off"
        />
        <div class="search-icon">ğŸ”</div>
        <button id="search-clear" class="search-clear">Ã—</button>
      </div>
    </div>

    <div id="search-stats" class="search-stats" style="display: none"></div>
    <div id="loading" class="loading">ã‚¢ã‚¤ã‚³ãƒ³ã‚’èª­ã¿è¾¼ã¿ä¸­...</div>
    <div id="icons-container" class="icons-grid"></div>

    <div id="toast" class="toast"></div>

    <script>
      // ãƒ•ã‚©ãƒ«ãƒ€åã‚’è‡ªå‹•å–å¾—
      const folderName =
        window.location.pathname
          .split("/")
          .filter((p) => p)
          .pop() || "";

      // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’è‡ªå‹•è¨­å®š
      if (folderName) {
        const displayName = folderName.toUpperCase();
        document.getElementById(
          "page-title"
        ).textContent = `${displayName} Icons`;
        document.title = `${displayName} Icons - Icons Factory`;
      }

      // ã‚¢ã‚¤ã‚³ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®è¡¨ç¤ºç”¨URLï¼ˆç›¸å¯¾ãƒ‘ã‚¹ï¼‰
      const getIconDisplayUrl = (filename) => {
        return `./${filename}`;
      };

      // URLã‚³ãƒ”ãƒ¼ç”¨ã®çµ¶å¯¾URL
      const getIconCopyUrl = (filename) => {
        const baseUrl =
          window.location.origin + window.location.pathname.replace(/\/$/, "");
        return `${baseUrl}/${filename}`;
      };

      // ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚¹ãƒˆJSONã®URL
      const getIconListUrl = () => {
        return "./icons.json";
      };

      // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
      function showToast(message, type = "info") {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.className = "toast show";
        if (type === "error") {
          toast.style.backgroundColor = "#f44336";
        } else {
          toast.style.backgroundColor = "#333";
        }
        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // URLã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
      async function copyUrl(filename) {
        const url = getIconCopyUrl(filename);
        try {
          await navigator.clipboard.writeText(url);
          showToast("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");
        } catch (err) {
          showToast("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
        }
      }

      // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
      async function downloadIcon(filename) {
        try {
          showToast("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æº–å‚™ä¸­...");

          // ç›¸å¯¾ãƒ‘ã‚¹ã§ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆåŒä¸€ã‚ªãƒªã‚¸ãƒ³ãªã®ã§CORSåˆ¶é™ãªã—ï¼‰
          const response = await fetch(`./${filename}`);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);

          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          a.style.display = "none";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);

          // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆURLã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
          window.URL.revokeObjectURL(url);

          showToast("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ãŸ");
        } catch (error) {
          console.error("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:", error);
          showToast("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ", "error");
        }
      }

      // æ¤œç´¢æ©Ÿèƒ½å¤‰æ•°
      let allIcons = [];
      let searchTimeout;

      // æ¤œç´¢å®Ÿè¡Œ
      function performSearch(query) {
        const normalizedQuery = query.toLowerCase().trim();

        if (!normalizedQuery) {
          displayIcons(allIcons);
          updateSearchStats(allIcons.length, allIcons.length);
          return;
        }

        const filteredIcons = allIcons.filter((filename) => {
          const iconName = filename.replace(".png", "").toLowerCase();
          return iconName.includes(normalizedQuery);
        });

        displayIcons(filteredIcons, normalizedQuery);
        updateSearchStats(filteredIcons.length, allIcons.length);
      }

      // ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤º
      function displayIcons(icons, searchQuery = "") {
        const iconsContainer = document.getElementById("icons-container");

        if (icons.length === 0 && searchQuery) {
          iconsContainer.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">ğŸ”</div>
                        <div>ã€Œ${escapeHtml(
                          searchQuery
                        )}ã€ã«ãƒãƒƒãƒã™ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</div>
                    </div>
                `;
        } else if (icons.length === 0) {
          iconsContainer.innerHTML =
            '<p style="text-align: center; color: #666;">ã‚¢ã‚¤ã‚³ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
        } else {
          const iconsHtml = icons
            .map((filename) => createIconCard(filename, searchQuery))
            .join("");
          iconsContainer.innerHTML = iconsHtml;
        }
      }

      // æ¤œç´¢çµ±è¨ˆæ›´æ–°
      function updateSearchStats(filteredCount, totalCount) {
        const searchStats = document.getElementById("search-stats");
        const searchInput = document.getElementById("category-search");

        if (searchInput.value.trim()) {
          searchStats.textContent = `${totalCount}ä»¶ä¸­ ${filteredCount}ä»¶ã‚’è¡¨ç¤º`;
          searchStats.style.display = "block";
        } else {
          searchStats.style.display = "none";
        }
      }

      // ã‚¢ã‚¤ã‚³ãƒ³ã‚«ãƒ¼ãƒ‰ã‚’å‹•çš„ã«ç”Ÿæˆï¼ˆãƒã‚¤ãƒ©ã‚¤ãƒˆä»˜ãï¼‰
      function createIconCard(filename, searchQuery = "") {
        let iconName = filename.replace(".png", "").replace(/-/g, " ");

        // æ¤œç´¢ã‚¯ã‚¨ãƒªãŒã‚ã‚‹å ´åˆã¯ãƒã‚¤ãƒ©ã‚¤ãƒˆ
        if (searchQuery) {
          iconName = highlightText(iconName, searchQuery);
        }

        const iconUrl = getIconDisplayUrl(filename);
        const iconId = `icon_${Date.now()}_${Math.random()
          .toString(36)
          .substr(2, 9)}`;

        return `
                <div class="icon-card">
                    <div class="icon-image-container">
                        <img id="${iconId}" src="${iconUrl}" alt="${filename.replace(
          ".png",
          ""
        )}" class="icon-image" 
                             onerror="this.style.display='none'" onload="updateIconSize('${iconId}', '${filename}')">
                    </div>
                    <div class="icon-name">${iconName}</div>
                    <div id="${iconId}_size" class="icon-size">èª­ã¿è¾¼ã¿ä¸­...</div>
                    <div class="button-group">
                        <button class="btn btn-copy" onclick="copyUrl('${filename}')">
                            ğŸ“‹ URL ã‚³ãƒ”ãƒ¼
                        </button>
                        <button class="btn btn-download" onclick="downloadIcon('${filename}')">
                            ğŸ’¾ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            `;
      }

      // ãƒ†ã‚­ã‚¹ãƒˆãƒã‚¤ãƒ©ã‚¤ãƒˆ
      function highlightText(text, query) {
        if (!query.trim()) return escapeHtml(text);

        const escapedText = escapeHtml(text);
        const escapedQuery = escapeHtml(query);
        const regex = new RegExp(`(${escapedQuery})`, "gi");

        return escapedText.replace(regex, '<span class="highlight">$1</span>');
      }

      // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºå–å¾—ãƒ»è¡¨ç¤º
      function updateIconSize(iconId, filename) {
        const img = document.getElementById(iconId);
        const sizeDiv = document.getElementById(`${iconId}_size`);

        if (img && sizeDiv) {
          if (img.naturalWidth && img.naturalHeight) {
            sizeDiv.textContent = `${img.naturalWidth} Ã— ${img.naturalHeight}px`;
          } else {
            sizeDiv.textContent = "ã‚µã‚¤ã‚ºå–å¾—å¤±æ•—";
          }
        }
      }

      // ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿ï¼ˆæ¤œç´¢å¯¾å¿œç‰ˆï¼‰
      async function loadIconList() {
        const iconsContainer = document.getElementById("icons-container");
        const loading = document.getElementById("loading");

        try {
          // GitHub Actionsã§ç”Ÿæˆã•ã‚ŒãŸã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚¹ãƒˆã‚’å–å¾—
          const response = await fetch(getIconListUrl());
          if (!response.ok) {
            throw new Error("ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚¹ãƒˆã®å–å¾—ã«å¤±æ•—");
          }

          const data = await response.json();
          allIcons = data.icons || [];

          if (allIcons.length > 0) {
            displayIcons(allIcons);
            updateSearchStats(allIcons.length, allIcons.length);
            showToast(`${allIcons.length}å€‹ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
          } else {
            iconsContainer.innerHTML =
              '<p style="text-align: center; color: #666;">ã‚¢ã‚¤ã‚³ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>';
          }
        } catch (error) {
          console.error("ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:", error);
          iconsContainer.innerHTML =
            '<p style="text-align: center; color: #ff4444;">ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
          showToast("ã‚¢ã‚¤ã‚³ãƒ³ãƒªã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ");
        } finally {
          // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤º
          loading.style.display = "none";
        }
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
      document.addEventListener("DOMContentLoaded", function () {
        loadIconList();

        const searchInput = document.getElementById("category-search");
        const clearButton = document.getElementById("search-clear");

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢
        searchInput.addEventListener("input", function (e) {
          const query = e.target.value;

          // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®è¡¨ç¤º/éè¡¨ç¤º
          clearButton.classList.toggle("visible", query.length > 0);

          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            performSearch(query);
          }, 300);
        });

        // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³
        clearButton.addEventListener("click", function () {
          searchInput.value = "";
          clearButton.classList.remove("visible");
          performSearch("");
          searchInput.focus();
        });

        // ESCã‚­ãƒ¼ã§æ¤œç´¢ã‚¯ãƒªã‚¢
        searchInput.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            searchInput.value = "";
            clearButton.classList.remove("visible");
            performSearch("");
          }
        });
      });
    </script>
  </body>
</html>
